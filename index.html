<!DOCTYPE html>
<html>
  <head>
    <title>My A-Frame Labyrinth Scene</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.7/dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    <a-scene background="color: #000000">
      <a-assets>
        <a-asset-item id="labyrinthe" src="./assets/labyrinthe.glb"></a-asset-item>
        <a-asset-item id="navmesh" src="./assets/labyrinthe-navmesh2.glb"></a-asset-item>
      </a-assets>

      <a-entity id="rig" movement-controls="constrainToNavMesh: true;">
        <a-entity
          camera
          position="0 1 0"
          look-controls="pointerLockEnabled: false">
          <a-cursor></a-cursor>
          
          <!-- Le timer -->
          <a-entity
            id="timer"
            text="value: 05:00; color: white; align: center;"
            position="1.3 0.7 -1"
            visible="false">
          </a-entity>
        </a-entity>

        <a-entity
          oculus-touch-controls="hand: left"
          laser-controls="hand: right"
          raycaster="objects: .collidable; showline: true; far: 10"
          line="color: red">
        </a-entity>

        <a-entity
          oculus-touch-controls="hand: right"
          laser-controls="hand: left"
          raycaster="objects: .collidable; showline: true; far: 10"
          line="color: red">
        </a-entity>
      </a-entity>

      <!-- Modèle du labyrinthe -->
      <a-entity 
        gltf-model="#labyrinthe" 
        position="0 0 -50" 
        rotation="0 90 0" 
        scale="3 3 3">
      </a-entity>

      <!-- Nav mesh pour la navigation -->
      <a-entity
        nav-mesh
        normal-material
        visible="false"
        position=".036 0.001 -50"
        rotation="0 90 0"
        scale="3 3 3"
        gltf-model="#navmesh">
      </a-entity>
   


      <script>
        AFRAME.registerComponent('start-timer', {
          init: function () {
            const timer = document.querySelector('#timer');
            let timeRemaining = 300; // Pour mettre 5min

            function updateTimerDisplay() {
              const minutes = Math.floor(timeRemaining / 60);
              const seconds = timeRemaining % 60;
              timer.setAttribute('text', `value: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
            }

            timer.setAttribute('visible', true);
            const interval = setInterval(() => {
              if (timeRemaining > 0) {
                timeRemaining -= 1;
                updateTimerDisplay();
              } else {
                clearInterval(interval);
                timer.setAttribute('visible', false);
                alert('Temps écoulé !');
              }
            }, 1000);
          }
        });

        document.querySelector('a-scene').setAttribute('start-timer', '');
      </script>

    </a-scene>
  </body>
</html>